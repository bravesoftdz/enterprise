/*
** SEPARAR FOTO DO PRODUTO
*/

CREATE TABLE PRO_IMAGENS (
    CODPRODUTO INTEGER NOT NULL,
    IMAGEM BLOB SUB_TYPE 0 SEGMENT SIZE 80);
ALTER TABLE PRO_IMAGENS
ADD CONSTRAINT PK_PRO_IMAGENS
PRIMARY KEY (CODPRODUTO);

ALTER TABLE PRO_IMAGENS
ADD CONSTRAINT FK_PRO_IMAGENS_1
FOREIGN KEY (CODPRODUTO)
REFERENCES PRODUTOS(CODIGO)
ON DELETE CASCADE
ON UPDATE CASCADE;

GRANT ALL ON PRO_IMAGENS TO PUBLIC;

INSERT INTO
  PRO_IMAGENS (
    CODPRODUTO,
    IMAGEM)
SELECT
  CODIGO,
  FOTO
FROM
  PRODUTOS
WHERE
  FOTO IS NOT NULL;
  
COMMIT;

ALTER TABLE PRODUTOS DROP FOTO;

INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (417, CURRENT_TIMESTAMP);
COMMIT;

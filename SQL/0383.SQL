/*
** PESO NOS PRODUTOS
*/

ALTER TABLE PRODUTOS ADD PESO NUMERIC(9,3);

SET TERM ^ ;

ALTER TRIGGER VERIFICA_BARRA_UPD
ACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE TEMP_EAN VARCHAR(13);
BEGIN
   IF (NEW.INDIVIDUAL = 'N') THEN
    BEGIN
     EXECUTE PROCEDURE CALC_EAN13(NEW.BARRA)
       RETURNING_VALUES :TEMP_EAN;
     IF (NEW.BARRA <> TEMP_EAN) THEN
        EXCEPTION PRODUTO_BARRA;
    END
   IF ((NEW.PRECOCUSTO < 0) OR (NEW.PRECOVENDA < 0)) THEN
      EXCEPTION VALOR_ZERO;
   IF (NEW.PESO IS NULL) THEN
     NEW.PESO = 0;
--   IF (NEW.PRECOCUSTO > NEW.PRECOVENDA) THEN
--      EXCEPTION PRECOCUSTO_MAIOR;
END
^

SET TERM ; ^

SET TERM ^ ;

ALTER TRIGGER VERIFICA_BARRA_INS
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE TEMP_EAN VARCHAR(13);
BEGIN
   IF (NEW.INDIVIDUAL = 'N') THEN
    BEGIN
     EXECUTE PROCEDURE CALC_EAN13(NEW.BARRA)
       RETURNING_VALUES :TEMP_EAN;
     IF (NEW.BARRA <> TEMP_EAN) THEN
        EXCEPTION PRODUTO_BARRA;
    END
   IF ((NEW.PRECOCUSTO < 0) OR (NEW.PRECOVENDA < 0)) THEN
      EXCEPTION VALOR_ZERO;
   IF (NEW.PRECOCUSTO > NEW.PRECOVENDA) THEN
      EXCEPTION PRECOCUSTO_MAIOR;
   IF (NEW.PESO IS NULL) THEN
     NEW.PESO = 0;
END
^

SET TERM ; ^

UPDATE
  PRODUTOS
SET
  PESO = 0;

INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (383, CURRENT_TIMESTAMP);
COMMIT;

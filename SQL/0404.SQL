/*
** PRIVILÉGIO DE VISUALIZAR OCULTOS
*/

ALTER TABLE CLIENTES ADD OCULTOS SIMNAO;

ALTER TABLE CLIENTES ADD ANALISES SIMNAO;

ALTER TABLE CLIENTES ADD LOGS SIMNAO;

SET TERM ^ ;

ALTER TRIGGER CLIENTES_DOCUPD
INACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE RETORNO INTEGER;
BEGIN

  EXECUTE PROCEDURE VALIDA_CPF(NEW.CPF)
    RETURNING_VALUES RETORNO;

  IF (RETORNO = 0) THEN
    EXCEPTION CPF_ERRADO;

  EXECUTE PROCEDURE VALIDA_CNPJ(NEW.CGC)
    RETURNING_VALUES RETORNO;

  IF (RETORNO = 0) THEN
    EXCEPTION CGC_ERRADO;

END
^

SET TERM ; ^

SET TERM ^ ;

ALTER TRIGGER CLIENTE_FAMILIA_UPDATE
INACTIVE BEFORE UPDATE POSITION 0
AS
BEGIN
  /* NOME DE FAMILIA */
  IF (NEW.PESSOAFISICA = 'F') THEN
     EXECUTE PROCEDURE FAMILIA(NEW.NOME)
       RETURNING_VALUES NEW.NOME_FAMILIA;
  ELSE
     NEW.NOME_FAMILIA = NEW.NOME;
END
^

SET TERM ; ^

UPDATE
  CLIENTES
SET
  OCULTOS = 'N';
  
UPDATE 
  CLIENTES
SET 
  ANALISES = 'N';

UPDATE 
  CLIENTES
SET 
  LOGS = 'N';

SET TERM ^ ;

ALTER TRIGGER CLIENTE_FAMILIA_UPDATE
ACTIVE BEFORE UPDATE POSITION 0
AS
BEGIN
  /* NOME DE FAMILIA */
  IF (NEW.PESSOAFISICA = 'F') THEN
     EXECUTE PROCEDURE FAMILIA(NEW.NOME)
       RETURNING_VALUES NEW.NOME_FAMILIA;
  ELSE
     NEW.NOME_FAMILIA = NEW.NOME;
END
^

SET TERM ; ^

SET TERM ^ ;

ALTER TRIGGER CLIENTES_DOCUPD
ACTIVE BEFORE UPDATE POSITION 0
AS
DECLARE VARIABLE RETORNO INTEGER;
BEGIN

  EXECUTE PROCEDURE VALIDA_CPF(NEW.CPF)
    RETURNING_VALUES RETORNO;

  IF (RETORNO = 0) THEN
    EXCEPTION CPF_ERRADO;

  EXECUTE PROCEDURE VALIDA_CNPJ(NEW.CGC)
    RETURNING_VALUES RETORNO;

  IF (RETORNO = 0) THEN
    EXCEPTION CGC_ERRADO;

END
^

SET TERM ; ^

INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (404, CURRENT_TIMESTAMP);
COMMIT;

/*
** VERIFICACAO DO CPF OU CNPJ
*/

CREATE EXCEPTION CPF_CADASTRADO 'CPF JÁ CADASTRADO.';

CREATE EXCEPTION CNPJ_CADASTRADO 'CNPJ JÁ CADASTRADO.';

SET TERM ^ ;

CREATE TRIGGER CLIENTES_VERIDOC FOR CLIENTES
ACTIVE BEFORE INSERT POSITION 0
AS
DECLARE VARIABLE TESTE INTEGER;
BEGIN

  /* TESTO O CPF */
  SELECT
    1
  FROM
    CLIENTES
  WHERE
    CLIENTES.CPF = NEW.CPF
  INTO
    :TESTE;

  IF (TESTE = 1) THEN
    EXCEPTION CPF_CADASTRADO;

  /* TESTE DO CNPJ */
  SELECT
    1
  FROM
    CLIENTES
  WHERE
    CLIENTES.CGC = NEW.CGC
  INTO
    :TESTE;

  IF (TESTE = 1) THEN
    EXCEPTION CPF_CADASTRADO;

END
^

SET TERM ; ^

INSERT INTO SCRIPTVER(NUMERO, DATA) VALUES (401, CURRENT_TIMESTAMP);
COMMIT;
